define("tiny_codepro/ui",["exports","./modal","core/modal_factory","core/modal_events","./common"],(function(_exports,_modal,_modal_factory,_modal_events,_common){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Tiny CodePro plugin.
   *
   * @module      tiny_codepro/plugin
   * @copyright   2023 Josep Mulet Pol <pmulet@iedib.net>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.handleAction=void 0,_modal=_interopRequireDefault(_modal),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events);let modal=null,codeEditorInstance=null;_exports.handleAction=editor=>{console.log("handleAction"),null===modal?(console.log("createDialogue"),createDialogue(editor)):(console.log("Showing dialogue"),modal.show(),codeEditorInstance.setValue(editor))};const createDialogue=async editor=>{console.log("createDialogue....");const data={elementid:"codepro_editorroot"};modal=await _modal_factory.default.create({type:_modal.default.TYPE,templateContext:data,large:!0}),require.config({paths:{cm6:_common.baseUrl+"/vendor/codemirror6/dist/cm6-lazy.min"}}),require(["cm6"],(CodeProEditor=>{console.log("cm6 loaded: ",CodeProEditor);const themeSelector=modal.footer.find("select");modal.getRoot().find(".modal-dialog.modal-lg").css("max-width","90%"),modal.getRoot().off("keydown");const targetElem=modal.body.find("#codepro_editorroot")[0];codeEditorInstance=new CodeProEditor(targetElem),themeSelector.on("change",(evt=>{codeEditorInstance.setTheme(evt.target.value)})),modal.footer.find("button.btn[data-action]").on("click",(evt=>{evt.target.classList.contains("btn-primary")&&codeEditorInstance.updateContent(),modal.hide(),codeEditorInstance.setValue()})),modal.footer.find("button.btn.btn-light").on("click",(evt=>{evt.preventDefault();const ds=evt.currentTarget.dataset,icon=evt.currentTarget.querySelector("i.fa");ds.fs?"false"===ds.fs?(ds.fs="true",modal.header.hide(),modal.getRoot().find('[role="document"]').removeClass("modal-dialog modal-lg modal-dialog-scrollable"),modal.getRoot().find('[role="document"]').addClass("tiny_codepro-fullscreen")):(ds.fs="false",modal.header.show(),modal.getRoot().find('[role="document"]').removeClass("tiny_codepro-fullscreen"),modal.getRoot().find('[role="document"]').addClass("modal-dialog modal-lg modal-dialog-scrollable")):ds.theme?"light"===ds.theme?(ds.theme="dark",icon.classList.remove("fa-sun-o"),icon.classList.add("fa-moon-o"),codeEditorInstance.setTheme("dark"),modal.getRoot().find('[role="document"]').addClass("tiny_codepro-dark")):(ds.theme="light",icon.classList.remove("fa-moon-o"),icon.classList.add("fa-sun-o"),codeEditorInstance.setTheme("light"),modal.getRoot().find('[role="document"]').removeClass("tiny_codepro-dark")):ds.wrap&&("true"===ds.wrap?(ds.wrap=!1,codeEditorInstance.setLineWrapping(!1),icon.classList.remove("fa-exchange"),icon.classList.add("fa-long-arrow-right")):(ds.wrap=!0,codeEditorInstance.setLineWrapping(!0),icon.classList.add("fa-exchange"),icon.classList.remove("fa-long-arrow-right")))})),modal.getRoot().on(_modal_events.default.hidden,(()=>{codeEditorInstance.setValue()})),console.log("setting and showing"),modal.show(),codeEditorInstance.setValue(editor)}))}}));

//# sourceMappingURL=ui.min.js.map