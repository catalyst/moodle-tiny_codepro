define("tiny_codepro/ui",["exports","./modal","core/modal_factory","core/modal_events","./common"],(function(_exports,_modal,_modal_factory,_modal_events,_common){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classPrivateMethodInitSpec(obj,privateSet){_checkPrivateRedeclaration(obj,privateSet),privateSet.add(obj)}function _classPrivateFieldInitSpec(obj,privateMap,value){_checkPrivateRedeclaration(obj,privateMap),privateMap.set(obj,value)}function _checkPrivateRedeclaration(obj,privateCollection){if(privateCollection.has(obj))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateFieldGet(receiver,privateMap){return function(receiver,descriptor){if(descriptor.get)return descriptor.get.call(receiver);return descriptor.value}(receiver,_classExtractFieldDescriptor(receiver,privateMap,"get"))}function _classPrivateMethodGet(receiver,privateSet,fn){if(!privateSet.has(receiver))throw new TypeError("attempted to get private field on non-instance");return fn}function _classPrivateFieldSet(receiver,privateMap,value){return function(receiver,descriptor,value){if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(receiver,_classExtractFieldDescriptor(receiver,privateMap,"set"),value),value}function _classExtractFieldDescriptor(receiver,privateMap,action){if(!privateMap.has(receiver))throw new TypeError("attempted to "+action+" private field on non-instance");return privateMap.get(receiver)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.handleAction=void 0,_modal=_interopRequireDefault(_modal),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events);const addCssLink=(href,id)=>{const linkElem=document.createElement("link");linkElem.id=id,linkElem.setAttribute("rel","stylesheet"),linkElem.setAttribute("href",href),document.head.appendChild(linkElem)};
/**
   * Tiny CodePro plugin.
   *
   * @module      tiny_codepro/plugin
   * @copyright   2023 Josep Mulet Pol <pmulet@iedib.net>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */_exports.handleAction=editor=>{displayDialogue(editor)};const displayDialogue=async editor=>{const data={elementid:"codepro_"+editor.id},modal=await _modal_factory.default.create({type:_modal.default.TYPE,templateContext:data,large:!0});modal.header.hide(),modal.footer.show();const targetElem=modal.body.find("#codepro_"+editor.id)[0];let codeEditor;codeEditor=new CodeMirrorEditor(targetElem,editor),await modal.show(),await codeEditor.create(),modal.onresize=function(){codeEditor.layout()},modal.footer.find("button.btn").on("click",(evt=>{evt.target.classList.contains("btn-primary")&&codeEditor.updateChanges(),modal.hide(),codeEditor.dispose(),modal.destroy()})),modal.getRoot().on(_modal_events.default.hidden,(()=>{codeEditor.dispose(),modal.destroy()}))};var _element=new WeakMap,_codeEditor=new WeakMap,_tinyEditor=new WeakMap,_lazyLoad=new WeakSet;class CodeMirrorEditor{constructor(element,tinyEditor){_classPrivateMethodInitSpec(this,_lazyLoad),_classPrivateFieldInitSpec(this,_element,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_codeEditor,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_tinyEditor,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_element,element),_classPrivateFieldSet(this,_tinyEditor,tinyEditor)}async create(){const CodeMirror=await _classPrivateMethodGet(this,_lazyLoad,_lazyLoad2).call(this);_classPrivateFieldSet(this,_codeEditor,new CodeMirror(_classPrivateFieldGet(this,_element),{mode:"text/html",value:_classPrivateFieldGet(this,_tinyEditor).getContent(),lineNumbers:!0,lineWrapping:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{F6:function(cm){cm.setOption("fullScreen",!cm.getOption("fullScreen"))},Esc:function(cm){cm.getOption("fullScreen")&&cm.setOption("fullScreen",!1)},"Ctrl-Q":function(cm){cm.foldCode(cm.getCursor())},"Ctrl-Space":"autocomplete"}})),_classPrivateFieldGet(this,_codeEditor).foldCode(CodeMirror.Pos(0,0)),_classPrivateFieldGet(this,_codeEditor).foldCode(CodeMirror.Pos(34,0))}updateChanges(){_classPrivateFieldGet(this,_tinyEditor).setContent(_classPrivateFieldGet(this,_codeEditor).getValue(),{format:"html"})}layout(){_classPrivateFieldGet(this,_tinyEditor).setSize("100%","100%"),_classPrivateFieldGet(this,_tinyEditor).refresh()}dispose(){}}function _lazyLoad2(){return document.head.querySelector("#codemirror_css")||(addCssLink(_common.baseUrl+"/vendor/codemirror5/lib/codemirror.css","codemirror_css"),addCssLink(_common.baseUrl+"/vendor/codemirror5/addon/display/fullscreen.css","codemirror_fullscreen_css"),addCssLink(_common.baseUrl+"/vendor/codemirror5/addon/fold/foldgutter.css","codemirror_foldgutter_css"),addCssLink(_common.baseUrl+"/vendor/codemirror5/addon/hint/show-hint.css","codemirror_showhint_css")),new Promise((resolve=>{window.cm?resolve(window.cm):(require.config({packages:[{name:"codemirror",location:_common.baseUrl+"/vendor/codemirror5",main:"lib/codemirror"}],paths:{codemirror:_common.baseUrl+"/vendor/codemirror5"}}),require(["codemirror/lib/codemirror","codemirror/mode/htmlmixed/htmlmixed","codemirror/addon/display/fullscreen","codemirror/addon/hint/show-hint","codemirror/addon/hint/html-hint","codemirror/addon/fold/foldcode","codemirror/addon/fold/foldgutter","codemirror/addon/fold/brace-fold"],(function(CodeMirror){console.log("requirejs resolves",CodeMirror),resolve(CodeMirror)})))}))}new WeakMap,new WeakMap,new WeakMap,new WeakSet}));

//# sourceMappingURL=ui.min.js.map