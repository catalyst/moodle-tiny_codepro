{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["/* eslint-disable no-undef */\n/* eslint-disable no-console */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport CodeProModal from \"./modal\";\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport { baseUrl } from './common';\n\n/**\n * Tiny CodePro plugin.\n *\n * @module      tiny_codepro/plugin\n * @copyright   2023 Josep Mulet Pol <pmulet@iedib.net>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nlet modal = null;\nlet codeEditorInstance = null;\n\n/**\n * Handle action\n * @param {TinyMCE} editor\n */\nexport const handleAction = (editor) => {\n    if (modal === null) {\n        createDialogue(editor);\n    } else {\n        modal.show();\n        codeEditorInstance.setValue(editor);\n    }\n};\n\nconst createDialogue = (editor) => {\n    // Load cm6 on demand\n    require.config({\n        paths: {\n            cm6: baseUrl + '/vendor/codemirror6/dist/editor.bundle'\n        }\n    });\n    require(['cm6'], async function(CodeProEditor) {\n        console.log(CodeProEditor);\n        const elementid = \"codepro_editorroot\";\n        const data = {\n            elementid: elementid,\n            themes: CodeProEditor.getThemes()\n        };\n\n        // Show modal with buttons.\n        modal = await ModalFactory.create({\n            type: CodeProModal.TYPE,\n            templateContext: data,\n            large: true,\n        });\n        modal.getRoot().find(\".modal-dialog.modal-lg\").css(\"max-width\", \"90%\");\n        modal.header.hide();\n        modal.footer.show();\n        console.log(modal);\n\n        const targetElem = modal.body.find('#' + elementid)[0];\n\n        codeEditorInstance = new CodeProEditor(targetElem);\n        modal.footer.find(\"select\").on(\"change\", (evt) => {\n            codeEditorInstance.setTheme(evt.target.value);\n        });\n        modal.footer.find(\"button.btn\").on(\"click\", (evt) => {\n            if (evt.target.classList.contains(\"btn-primary\")) {\n                codeEditorInstance.updateContent();\n            }\n            modal.hide();\n            codeEditorInstance.setValue();\n        });\n        modal.getRoot().on(ModalEvents.hidden, () => {\n            codeEditorInstance.setValue();\n        });\n\n        console.log(\"setting and showing\");\n        modal.show();\n        codeEditorInstance.setValue(editor);\n    });\n};"],"names":["modal","codeEditorInstance","editor","createDialogue","show","setValue","require","config","paths","cm6","baseUrl","async","CodeProEditor","console","log","data","elementid","themes","getThemes","ModalFactory","create","type","CodeProModal","TYPE","templateContext","large","getRoot","find","css","header","hide","footer","targetElem","body","on","evt","setTheme","target","value","classList","contains","updateContent","ModalEvents","hidden"],"mappings":";;;;;;;8OA8BIA,MAAQ,KACRC,mBAAqB,2BAMIC,SACX,OAAVF,MACAG,eAAeD,SAEfF,MAAMI,OACNH,mBAAmBI,SAASH,gBAI9BC,eAAkBD,SAEpBI,QAAQC,OAAO,CACXC,MAAO,CACHC,IAAKC,gBAAU,4CAGvBJ,QAAQ,CAAC,QAAQK,eAAeC,eAC5BC,QAAQC,IAAIF,qBAENG,KAAO,CACTC,UAFc,qBAGdC,OAAQL,cAAcM,aAI1BlB,YAAcmB,uBAAaC,OAAO,CAC9BC,KAAMC,eAAaC,KACnBC,gBAAiBT,KACjBU,OAAO,IAEXzB,MAAM0B,UAAUC,KAAK,0BAA0BC,IAAI,YAAa,OAChE5B,MAAM6B,OAAOC,OACb9B,MAAM+B,OAAO3B,OACbS,QAAQC,IAAId,aAENgC,WAAahC,MAAMiC,KAAKN,KAAK,uBAAiB,GAEpD1B,mBAAqB,IAAIW,cAAcoB,YACvChC,MAAM+B,OAAOJ,KAAK,UAAUO,GAAG,UAAWC,MACtClC,mBAAmBmC,SAASD,IAAIE,OAAOC,UAE3CtC,MAAM+B,OAAOJ,KAAK,cAAcO,GAAG,SAAUC,MACrCA,IAAIE,OAAOE,UAAUC,SAAS,gBAC9BvC,mBAAmBwC,gBAEvBzC,MAAM8B,OACN7B,mBAAmBI,cAEvBL,MAAM0B,UAAUQ,GAAGQ,sBAAYC,QAAQ,KACnC1C,mBAAmBI,cAGvBQ,QAAQC,IAAI,uBACZd,MAAMI,OACNH,mBAAmBI,SAASH"}