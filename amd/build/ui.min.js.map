{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["/* eslint-disable no-undef */\n/* eslint-disable no-console */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport CodeProModal from \"./modal\";\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport {baseUrl} from './common';\n\n/**\n * Tiny CodePro plugin.\n *\n * @module      tiny_codepro/plugin\n * @copyright   2023 Josep Mulet Pol <pep.mulet@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nlet modal = null;\nlet codeEditorInstance = null;\n\n/**\n * Handle action\n * @param {TinyMCE} editor\n */\nexport const handleAction = (editor) => {\n    if (modal === null) {\n        createDialogue(editor);\n    } else {\n        modal.show();\n        codeEditorInstance.setValue(editor);\n    }\n};\n\nconst createDialogue = async (editor) => {\n    const elementid = \"codepro_editorroot\";\n    const data = {\n        elementid: elementid\n    };\n\n    // Show modal with buttons.\n    modal = await ModalFactory.create({\n        type: CodeProModal.TYPE,\n        templateContext: data,\n        large: true,\n    });\n    modal.getRoot().find(\".modal-dialog.modal-lg\").css(\"max-width\", \"85%\");\n    // Disable ESC key on this modal\n    modal.getRoot().off('keydown');\n    modal.body.css(\"overflow-y\", \"overlay\");\n\n    // Load cm6 on demand\n    require.config({\n        paths: {\n            cm6pro: baseUrl + '/vendor/codemirror6/dist/cm6pro.min'\n        }\n    });\n    require(['cm6pro'], (CodeProEditor) => {\n        // Setting themes\n        const themeSelector = modal.footer.find(\"select\");\n        const targetElem = modal.body.find('#' + elementid)[0];\n\n        codeEditorInstance = new CodeProEditor(targetElem);\n        themeSelector.on(\"change\", (evt) => {\n            codeEditorInstance.setTheme(evt.target.value);\n        });\n        modal.footer.find(\"button.btn[data-action]\").on(\"click\", (evt) => {\n            if (evt.target.classList.contains(\"btn-primary\")) {\n                codeEditorInstance.updateContent();\n            }\n            modal.hide();\n            codeEditorInstance.setValue();\n        });\n        modal.footer.find(\"button.btn.btn-light\").on(\"click\", (evt) => {\n            evt.preventDefault();\n            const ds = evt.currentTarget.dataset;\n            const icon = evt.currentTarget.querySelector(\"i.fa\");\n            if (ds.fs) {\n                if (ds.fs === \"false\") {\n                    // Go to FS\n                    ds.fs = \"true\";\n                    modal.header.hide();\n                    modal.getRoot().find('[role=\"document\"]').removeClass(\"modal-dialog modal-lg modal-dialog-scrollable\");\n                    modal.getRoot().find('[role=\"document\"]').addClass(\"tiny_codepro-fullscreen\");\n                } else {\n                    // Return to modal\n                    ds.fs = \"false\";\n                    modal.header.show();\n                    modal.getRoot().find('[role=\"document\"]').removeClass(\"tiny_codepro-fullscreen\");\n                    modal.getRoot().find('[role=\"document\"]').addClass(\"modal-dialog modal-lg modal-dialog-scrollable\");\n                }\n            } else if (ds.theme) {\n                if (ds.theme === \"light\") {\n                    ds.theme = \"dark\";\n                    icon.classList.remove(\"fa-sun-o\");\n                    icon.classList.add(\"fa-moon-o\");\n                    codeEditorInstance.setTheme(\"dark\");\n                    modal.getRoot().find('[role=\"document\"]').addClass(\"tiny_codepro-dark\");\n                } else {\n                    ds.theme = \"light\";\n                    icon.classList.remove(\"fa-moon-o\");\n                    icon.classList.add(\"fa-sun-o\");\n                    codeEditorInstance.setTheme(\"light\");\n                    modal.getRoot().find('[role=\"document\"]').removeClass(\"tiny_codepro-dark\");\n                }\n            } else if (ds.wrap) {\n                if (ds.wrap === \"true\") {\n                    ds.wrap = false;\n                    codeEditorInstance.setLineWrapping(false);\n                    icon.classList.remove(\"fa-exchange\");\n                    icon.classList.add(\"fa-long-arrow-right\");\n                } else {\n                    ds.wrap = true;\n                    codeEditorInstance.setLineWrapping(true);\n                    icon.classList.add(\"fa-exchange\");\n                    icon.classList.remove(\"fa-long-arrow-right\");\n                }\n            }\n        });\n        modal.getRoot().on(ModalEvents.hidden, () => {\n            codeEditorInstance.setValue();\n        });\n\n        modal.show();\n        codeEditorInstance.setValue(editor);\n    });\n};"],"names":["modal","codeEditorInstance","editor","createDialogue","show","setValue","async","data","elementid","ModalFactory","create","type","CodeProModal","TYPE","templateContext","large","getRoot","find","css","off","body","require","config","paths","cm6pro","baseUrl","CodeProEditor","themeSelector","footer","targetElem","on","evt","setTheme","target","value","classList","contains","updateContent","hide","preventDefault","ds","currentTarget","dataset","icon","querySelector","fs","header","removeClass","addClass","theme","remove","add","wrap","setLineWrapping","ModalEvents","hidden"],"mappings":";;;;;;;8OA8BIA,MAAQ,KACRC,mBAAqB,2BAMIC,SACX,OAAVF,MACAG,eAAeD,SAEfF,MAAMI,OACNH,mBAAmBI,SAASH,gBAI9BC,eAAiBG,MAAAA,eAEbC,KAAO,CACTC,UAFc,sBAMlBR,YAAcS,uBAAaC,OAAO,CAC9BC,KAAMC,eAAaC,KACnBC,gBAAiBP,KACjBQ,OAAO,IAEXf,MAAMgB,UAAUC,KAAK,0BAA0BC,IAAI,YAAa,OAEhElB,MAAMgB,UAAUG,IAAI,WACpBnB,MAAMoB,KAAKF,IAAI,aAAc,WAG7BG,QAAQC,OAAO,CACXC,MAAO,CACHC,OAAQC,gBAAU,yCAG1BJ,QAAQ,CAAC,WAAYK,sBAEXC,cAAgB3B,MAAM4B,OAAOX,KAAK,UAClCY,WAAa7B,MAAMoB,KAAKH,KAAK,uBAAiB,GAEpDhB,mBAAqB,IAAIyB,cAAcG,YACvCF,cAAcG,GAAG,UAAWC,MACxB9B,mBAAmB+B,SAASD,IAAIE,OAAOC,UAE3ClC,MAAM4B,OAAOX,KAAK,2BAA2Ba,GAAG,SAAUC,MAClDA,IAAIE,OAAOE,UAAUC,SAAS,gBAC9BnC,mBAAmBoC,gBAEvBrC,MAAMsC,OACNrC,mBAAmBI,cAEvBL,MAAM4B,OAAOX,KAAK,wBAAwBa,GAAG,SAAUC,MACnDA,IAAIQ,uBACEC,GAAKT,IAAIU,cAAcC,QACvBC,KAAOZ,IAAIU,cAAcG,cAAc,QACzCJ,GAAGK,GACW,UAAVL,GAAGK,IAEHL,GAAGK,GAAK,OACR7C,MAAM8C,OAAOR,OACbtC,MAAMgB,UAAUC,KAAK,qBAAqB8B,YAAY,iDACtD/C,MAAMgB,UAAUC,KAAK,qBAAqB+B,SAAS,6BAGnDR,GAAGK,GAAK,QACR7C,MAAM8C,OAAO1C,OACbJ,MAAMgB,UAAUC,KAAK,qBAAqB8B,YAAY,2BACtD/C,MAAMgB,UAAUC,KAAK,qBAAqB+B,SAAS,kDAEhDR,GAAGS,MACO,UAAbT,GAAGS,OACHT,GAAGS,MAAQ,OACXN,KAAKR,UAAUe,OAAO,YACtBP,KAAKR,UAAUgB,IAAI,aACnBlD,mBAAmB+B,SAAS,QAC5BhC,MAAMgB,UAAUC,KAAK,qBAAqB+B,SAAS,uBAEnDR,GAAGS,MAAQ,QACXN,KAAKR,UAAUe,OAAO,aACtBP,KAAKR,UAAUgB,IAAI,YACnBlD,mBAAmB+B,SAAS,SAC5BhC,MAAMgB,UAAUC,KAAK,qBAAqB8B,YAAY,sBAEnDP,GAAGY,OACM,SAAZZ,GAAGY,MACHZ,GAAGY,MAAO,EACVnD,mBAAmBoD,iBAAgB,GACnCV,KAAKR,UAAUe,OAAO,eACtBP,KAAKR,UAAUgB,IAAI,yBAEnBX,GAAGY,MAAO,EACVnD,mBAAmBoD,iBAAgB,GACnCV,KAAKR,UAAUgB,IAAI,eACnBR,KAAKR,UAAUe,OAAO,4BAIlClD,MAAMgB,UAAUc,GAAGwB,sBAAYC,QAAQ,KACnCtD,mBAAmBI,cAGvBL,MAAMI,OACNH,mBAAmBI,SAASH"}